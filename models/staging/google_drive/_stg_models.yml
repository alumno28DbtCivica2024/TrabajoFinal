version: 2

models:
  - name: stg_per_info_members
    description: >
      Vista que agrupa y genera claves surrogate para datos del prestatario relacionados
      con empleo, propiedad de vivienda, estado de verificación, ubicación y relación deuda-ingreso.
    columns:
      - name: member_id
        description: Identificador único del prestatario.
        tests:
          - unique
          - not_null

      - name: emp_length_id
        description: Clave surrogate generada para la duración del empleo del prestatario.
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('stg_emp_length')
              field: emp_length_id

      - name: employ
        description: Título del empleo del prestatario o 'Unemployed' si no se especifica.

      - name: home_ownership_id
        description: Clave surrogate generada para el estado de propiedad de vivienda del prestatario.
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('stg_home_ownership')
              field: home_ownership_id

      - name: annual_inc
        description: Ingreso anual reportado del prestatario.

      - name: verification_status_id
        description: Clave surrogate generada para el estado de verificación del ingreso del prestatario.
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('stg_verification_status')
              field: verification_status_id

      - name: zip_code_id
        description: Clave surrogate generada para el código postal del prestatario.
        tests:
          - unique
          - not_null
          - relationships:
              to: ref('stg_zip_code')
              field: zip_code_id

      - name: addr_state
        description: Estado de residencia del prestatario.

      - name: dti
        description: Relación deuda-ingreso del prestatario.

  - name: stg_loan
    description: >
      Vista que proporciona información financiera detallada sobre los préstamos,
      incluyendo montos financiados, pagos realizados, recuperaciones, y estados
      del préstamo, con claves surrogate generadas para facilitar la gestión de datos.
    columns:
      - name: loan_id
        description: Identificador único del préstamo.
        tests:
          - unique
          - not_null

      - name: funded_amnt
        description: Monto total financiado para el préstamo.

      - name: funded_amnt_inv
        description: Monto total invertido en el préstamo por los inversionistas.

      - name: loan_status_id
        description: Clave surrogate generada para el estado del préstamo.
        tests:
          - not_null
          - relationships:
              to: ref('stg_loan_state')
              field: loan_state_id

      - name: out_prncp
        description: Principal restante pendiente del préstamo.

      - name: out_prncp_inv
        description: Principal restante pendiente para los inversionistas.

      - name: total_pymnt
        description: Pagos totales realizados redondeados a 2 decimales.

      - name: total_pymnt_inv
        description: Pagos totales realizados por los inversionistas.

      - name: total_rec_prncp
        description: Principal total recibido.

      - name: total_rec_int
        description: Intereses totales recibidos.

      - name: total_rec_late_fee
        description: Multas totales por pagos tardíos recibidas.

      - name: recoveries
        description: Monto recuperado en préstamos impagos.
        
      - name: collection_recovery_fee
        description: Cargos por recuperación de colecciones redondeados a 2 decimales.

  - name: stg_loan_payments
    description: >
      Vista que genera una clave surrogate única para los pagos y proporciona detalles 
      relacionados con los pagos de los préstamos, incluyendo fechas y montos de pagos 
      recientes y programados.
    columns:
      - name: payment_id
        description: Clave surrogate única generada a partir del ID del préstamo y la fecha del último pago.
        tests:
          - unique
          - not_null
      - name: loan_id
        description: Identificador único del préstamo.
        tests:
          - not_null
          - relationships:
              to: ref('stg_loan')
              field: loan_id

      - name: last_pymnt_d
        description: Fecha del último pago recibido en formato MM-YYYY.

      - name: last_pymnt_amnt
        description: Monto del último pago recibido.

      - name: next_pymnt_d
        description: Fecha del próximo pago programado en formato MM-YYYY.

  - name: stg_loan
    description: >
      Vista que proporciona información detallada sobre los préstamos, incluyendo montos, 
      términos, tasas de interés, planes de pago, propósito, y detalles de la aplicación.
    columns:
      - name: loan_id
        description: Identificador único del préstamo.
        tests:
          - unique
          - not_null

      - name: member_id
        description: Identificador único del prestatario.
        tests:
          - not_null
          - relationships:
              to: ref('stg_per_info_members')
              field: member_id

      - name: loan_amnt
        description: Monto total del préstamo solicitado.

      - name: term_months
        description: Plazo del préstamo en meses.

      - name: int_rate
        description: Tasa de interés aplicada al préstamo.

      - name: monthly_fee
        description: Cuota mensual asociada al préstamo.

      - name: grade
        description: Clasificación del préstamo basada en el riesgo crediticio.

      - name: sub_grade
        description: Subclasificación del préstamo basada en el riesgo crediticio.

      - name: issue_d
        description: Fecha de emisión del préstamo en formato MM-YYYY.

      - name: pymnt_plan
        description: Indica si el prestatario está en un plan de pagos (TRUE/FALSE).

      - name: desc
        description: Descripción proporcionada para el préstamo.

      - name: purpose_id
        description: Clave surrogate única generada a partir del propósito del préstamo.
        tests:
          - not_null
          - relationships:
              to: ref('stg_purpose')
              field: purpose_id

      - name: title
        description: Título del préstamo.

      - name: initial_list_status
        description: Estado inicial del listado del préstamo ('funded' o 'waitlist').

      - name: application_type
        description: Tipo de solicitud del préstamo ('Individual' o 'Joint').

      - name: policy_code
        description: Código que indica la política a la que pertenece el préstamo.

      - name: funded_amnt
        description: Monto total financiado para el préstamo.

      - name: funded_amnt_inv
        description: Monto total invertido en el préstamo por los inversionistas.

      - name: loan_status_id
        description: Clave surrogate generada para el estado del préstamo.
        tests:
          - not_null
          - relationships:
              to: ref('stg_loan_status')
              field: loan_status_id

      - name: out_prncp
        description: Principal restante pendiente del préstamo.

      - name: out_prncp_inv
        description: Principal restante pendiente para los inversionistas.

      - name: total_pymnt
        description: Pagos totales realizados redondeados a 2 decimales.

      - name: total_pymnt_inv
        description: Pagos totales realizados por los inversionistas.

      - name: total_rec_prncp
        description: Principal total recibido.

      - name: total_rec_int
        description: Intereses totales recibidos.

      - name: total_rec_late_fee
        description: Multas totales por pagos tardíos recibidas.

      - name: recoveries
        description: Monto recuperado en préstamos impagos.
        
      - name: collection_recovery_fee
        description: Cargos por recuperación de colecciones redondeados a 2 decimales.

  - name: stg_credit_history_member
    description: >
      Vista que proporciona información sobre el historial crediticio y el comportamiento financiero del prestatario,
      incluyendo consultas de crédito, saldos rotativos, registros públicos, y eventos relacionados con incumplimientos.
    columns:
      - name: member_id
        description: Identificador único del prestatario.
        tests:
          - not_null
          - unique

      - name: delinq_2_yrs
        description: Número de cuentas con retrasos de más de 30 días en los últimos 2 años.

      - name: earliest_cr_line
        description: Fecha de apertura de la línea de crédito más antigua en formato MM-YYYY.

      - name: inq_last_6_mths
        description: Número de consultas de crédito en los últimos 6 meses.

      - name: mths_since_last_delinq
        description: Meses desde el último incumplimiento reportado.

      - name: mths_since_last_record
        description: Meses desde el último registro público negativo.

      - name: open_acc
        description: Número total de cuentas de crédito abiertas.

      - name: pub_rec
        description: Número de registros públicos reportados.

      - name: revol_bal
        description: Saldo rotativo total del prestatario.

      - name: revol_util
        description: Uso del crédito rotativo como porcentaje.

      - name: total_acc
        description: Número total de cuentas de crédito.

      - name: last_credit_pull_d
        description: Fecha de la última consulta de crédito en formato MM-YYYY.

      - name: collections_12_mths_ex_med
        description: Cantidad de cobros en los últimos 12 meses excluyendo lo médico.

      - name: mths_since_last_major_derog
        description: Meses desde la última falta grave reportada.

  - name: stg_purpose
    description: >
      Vista que genera un conjunto de propósitos únicos relacionados con los préstamos, asignando un identificador único a cada propósito.
    columns:
      - name: purpose_id
        description: Identificador único generado para cada propósito del préstamo.
        tests:
          - unique
          - not_null

      - name: purpose
        description: Propósito del préstamo, como 'educación', 'hogar' o 'viajes', entre otros.
        tests:
          - not_null

  - name: stg_zip_code
    description: >
      Vista que genera un conjunto único de códigos postales relacionados con los préstamos, asignando un identificador único a cada código postal.
    columns:
      - name: zip_code_id
        description: Identificador único generado para cada código postal.
        tests:
          - unique
          - not_null

      - name: zip_code
        description: Código postal asociado al prestatario.
        tests:
          - not_null

  - name: stg_verification_status
    description: >
      Vista que genera un conjunto único de estados de verificación de préstamo, asignando un identificador único a cada estado de verificación.
    columns:
      - name: verification_status_id
        description: Identificador único generado para cada estado de verificación de préstamo.
        tests:
          - unique
          - not_null

      - name: verification_status
        description: Estado de verificación del ingreso del prestatario, indicando si el ingreso ha sido verificado.
        tests:
          - not_null

  - name: stg_loan_status
    description: >
      Vista que genera un conjunto único de estados de préstamo, asignando un identificador único a cada estado de préstamo.
    columns:
      - name: loan_status_id
        description: Identificador único generado para cada estado de préstamo.
        tests:
          - unique
          - not_null

      - name: loan_status
        description: Estado actual del préstamo, indicando su situación (aprobado, en pago, etc.).
        tests:
          - not_null

  - name: stg_home_ownership
    description: >
      Vista que genera un conjunto único de estados de propiedad de vivienda, asignando un identificador único a cada tipo de propiedad.
    columns:
      - name: home_ownership_id
        description: Identificador único generado para cada tipo de propiedad de vivienda.
        tests:
          - unique
          - not_null
          
      - name: home_ownership
        description: Estado de propiedad de vivienda del prestatario (por ejemplo, 'Own', 'Rent', etc.).
        tests:
          - not_null
  
  - name: stg_emp_length
    description: >
      Vista que genera un conjunto único de estados de empleo, asignando un identificador único a cada tipo de antigüedad laboral del prestatario.
    columns:
      - name: emp_length_id
        description: Identificador único generado para cada antigüedad laboral del prestatario.
        tests:
          - unique
          - not_null
          
      - name: emp_length
        description: Años de empleo del prestatario en formato textual (por ejemplo, '1 year', '10+ years', etc.).
        tests:
          - not_null
